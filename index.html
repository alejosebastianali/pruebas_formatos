<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consulta de V치lvulas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; }
    #chat-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    #chat-container {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 100%;
      max-width: 400px;
      max-height: 80%;
      background: white;
      border-radius: 15px;
      overflow-y: auto;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      padding: 20px;
      z-index: 1000;
    }
    .chat-message { margin-bottom: 15px; }
    .chat-input, .btn { width: 100%; margin-top: 5px; }
    @media (max-width: 480px) {
      #chat-container {
        right: 10px;
        left: 10px;
        width: auto;
      }
    }
  </style>
</head>
<body>

<button id="chat-button">Quiero realizar una consulta</button>

<div id="chat-container" class="shadow-lg">
  <div id="chat-content"></div>
  <input type="text" id="chat-input" class="form-control chat-input" placeholder="Escribe tu respuesta aqu칤..." />
  <button id="chat-next" class="btn btn-success">Enviar</button>
</div>

<script>
const chatContent = document.getElementById("chat-content");
const chatInput = document.getElementById("chat-input");
const chatNext = document.getElementById("chat-next");
let currentQuestion = 0, answers = [], selectedGroup = null, questions = [];

const group1 = [
  "쮺u치l es el di치metro?", "쮺u치l es el pasaje?", "쮺u치l es la presi칩n / serie?",
  "쮺u치l es el material del cuerpo?", "쮺u치les son los extremos de conexi칩n?",
  "쯈u칠 fluido circula?", "쮺u치l es la temperatura de operaci칩n?", "쮸lguna aclaraci칩n sobre el funcionamiento?"
];
const group2 = [
  "쮺u치l es el di치metro?", "쮺u치l es el pasaje?", "쮺u치l es la presi칩n / serie del fluido?",
  "쮺u치l es el material del cuerpo?", "쮺u치les son los extremos de conexi칩n?", "쯈u칠 fluido circula?",
  "쯈u칠 tipo de actuador?", "쮺u치l es la presi칩n de suministro del actuador? (si es neum치tico)",
  "쮺u치l es la tensi칩n de red del actuador? (si es el칠ctrico)", "쮺u치l es el 풊P?", "쮺u치l es la temperatura de operaci칩n?"
];

document.getElementById("chat-button").onclick = () => {
  document.getElementById("chat-button").style.display = "none";
  document.getElementById("chat-container").style.display = "block";
  chatContent.innerHTML = '<div class="chat-message">춰Hola! 游땕 쯈u칠 tipo de v치lvula deseas consultar?</div>';
  chatContent.innerHTML += `<div class="chat-message">
    <input type="radio" name="tipo" value="representante" onchange="hablarConRepresentante()"> Hablar con un representante<br>
    <input type="radio" name="tipo" value="manual" onchange="selectGroup('manual')"> V치lvula Manual<br>
    <input type="radio" name="tipo" value="automatica" onchange="selectGroup('automatica')"> V치lvula Autom치tica
  </div>`;
  chatInput.style.display = "none";
  chatNext.style.display = "none";
};

window.hablarConRepresentante = function() {
  const mensaje = "Quiero cotizar un pedido";
  window.open("https://wa.me/541131470155?text=" + encodeURIComponent(mensaje), "_blank");
};

window.selectGroup = function(group) {
  selectedGroup = group;
  questions = group === "manual" ? group1 : group2;
  currentQuestion = 0;
  answers = [];
  chatContent.innerHTML += `<div class="chat-message">Has seleccionado: <strong>V치lvula ${group === "manual" ? 'Manual' : 'Autom치tica'}</strong></div>`;
  showNextQuestion();
  chatInput.style.display = "block";
  chatNext.style.display = "inline-block";
};

chatNext.onclick = () => {
  const value = chatInput.value.trim();
  if (!value) return;
  answers[currentQuestion] = value;
  chatInput.value = "";
  currentQuestion++;
  currentQuestion < questions.length ? showNextQuestion() : showSummary();
};

function showNextQuestion() {
  const q = questions[currentQuestion];
  chatContent.innerHTML += `<div class="chat-message">${q}</div>`;
  chatInput.style.display = "block";
  chatInput.focus();
  chatContent.scrollTop = chatContent.scrollHeight;
}

function showSummary() {
  chatContent.innerHTML += `<div class="chat-message"><strong>Resumen de tus respuestas:</strong></div>`;
  questions.forEach((q, i) => {
    chatContent.innerHTML += `<div class="chat-message">${q}<br>
      <input class="chat-input" value="${answers[i] || ''}" onchange="answers[${i}] = this.value" /></div>`;
  });
  chatContent.innerHTML += `<button class="btn btn-primary" onclick="submitAnswers()">Enviar consulta</button>`;
  chatInput.style.display = "none";
  chatNext.style.display = "none";
  chatContent.scrollTop = chatContent.scrollHeight;
}

function submitAnswers() {
  fetch('enviar.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ grupo: selectedGroup, answers })
  })
  .then(res => res.ok ? window.location.href = "confirmacion.html" : alert("Error al enviar."))
  .catch(() => alert("Fallo en el env칤o."));
}
</script>
</body>
</html>
